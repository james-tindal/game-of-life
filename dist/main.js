(()=>{"use strict";const t=()=>({match:t=>t.None()}),e=Stream=(e,{is_memory_stream:r=!1}={})=>{let a=t;const n=[],o=t=>{n.forEach((e=>e(t))),r&&(a=(t=>({match:e=>e.Some(t)}))(t))};let i=()=>{};function d(t){n.includes(t)||(r&&a.match({Some(e){t(e)},None(){}}),n.push(t)),1===n.length&&(i=e(o))}function c(t){n.splice(n.indexOf(t),1),0===n.length&&(i(),i=()=>{})}function m(t){return d(t),()=>c(t)}return self={addListener:d,removeListener:c,subscribe:m,map:t=>Stream((e=>m((r=>e(t(r)))))),mapTo:t=>Stream((e=>m((()=>e(t))))),take:t=>Stream((e=>{let r=0;return unsubscribe=m((a=>r<t?e(a)&&r++:unsubscribe()))})),takeUntil:t=>Stream((e=>{const r=m(e),a=t.subscribe((()=>{r(),a()}));return()=>{r(),a()}})),filter:t=>Stream((e=>m((r=>t(r)&&e(r))))),flatten:()=>Stream((t=>m((e=>e.subscribe((e=>t(e))))))),startWith:t=>Stream((e=>(e(t),m(e)))),log:()=>(d(console.log.bind(console)),self),remember:()=>Stream((t=>m(t)),{is_memory_stream:!0}),scan:(t,e)=>{let r=e;return Stream((e=>m((a=>{r=t(r,a),e(r)}))))},imitate:t=>t.addListener(o)}};Stream.merge=(t,e)=>Stream((r=>{t.addListener(r),e.addListener(r)})),Stream.of=t=>Stream((e=>setTimeout((()=>e(t))))),Stream.periodic=t=>Stream((e=>{let r=0,a=setInterval((()=>{e(r),r++}),t);return()=>{clearInterval(a)}})),Stream.empty=()=>Stream((()=>()=>{})),Stream.combine=()=>Stream((()=>{})),Stream.event=(t,e,{preventDefault:r=!1}={})=>Stream((a=>t.addEventListener(e,(t=>{r&&t.preventDefault(),a(t)}))));const r=t=>e=>({...e,type:t}),{button:a,table:n,tbody:o,tr:i,td:d,input:c}=["button","table","tbody","tr","td","input"].reduce(((t,e)=>({...t,[e]:r(e)}))),m=t=>new Proxy((()=>{}),t);m.get=t=>new Proxy((()=>{}),{get:t});const s={},l=m.get((t=>m.get((r=>{const a=e.empty();return void 0===s[t]?s[t]={[r]:a}:s[t][r]=a,a})))),u=(t,e,r)=>t.setAttribute(e,r);function p(t){if("string"==typeof t)return document.createTextNode(t);const r=document.createElement(t.type);return((t,r)=>{((t,e)=>{Object.keys(e).forEach((r=>u(t,r,e[r])))})(t,r.attr),((t,e)=>{Object.keys(e).forEach((r=>setDataAttr(t,r,e[r])))})(t,r.data),((t,r)=>{t.setAttribute("id",r),s.hasOwnProperty(r)&&Object.entries(s[r]).forEach((([r,a])=>a.imitate(e.event(t,r))))})(t,r.id)})(r,t),t.children.map(p).forEach(r.appendChild.bind(r)),r}function f(t,e,r,a){a&&!r?function(t,e){t.removeAttribute(e)}(t,e):a&&r===a||u(t,e,r)}function b(t,e,r,a){a&&!r?function(t,e){delete t.dataset[e]}(t,e):a&&r===a||((t,e,r)=>{t.dataset[e]=r})(t,e,r)}const y=(t={},e={})=>Object.keys({...t,...e});const h=(t,e,r,a=0)=>{return r?e?typeof(n=e)!=typeof(o=r)||"string"==typeof n&&n!==o||n.type!==o.type?t.replaceChild(p(e),t.childNodes[a]):e.type?function(t,e,r){r&&!1===e.should_update||(function(t,e,r){for(key of y(e.attr,r.attr))f(t,key,e.attr[key],r.attr[key]);for(key of y(e.data,r.data))b(t,key,e.data[key],r.data[key])}(t,e,r),g(t,e,r))}(t.childNodes[a],e,r):void 0:t.removeChild(t.childNodes[a]):t.appendChild(p(e));var n,o};function g(t,e,r){const a=e.children.length,n=r.children.length;for(let o=0;o<a||o<n;o++)h(t,e.children[o],r.children[o],o)}const S=merge(l.go_button.click.mapTo(!0),l.clear_button.click.mapTo(!1)).scan(((t,e)=>!0===e&&!t||!1===e&&!1),!1),v=(l.speed_input.input.map((t=>Number(t.target.value))).remember(),S.map((t=>t?speed_input.take(1):e.empty())).flatten()),k=combine([S,v]).map((([t,r])=>t?e.periodic(r):e.empty())).flatten().mapTo(),_=l.grid.mousedown.map((t=>t.target.dataset)),w=l.grid.mouseover,N=l.grid.mouseup,A=l.document.mouseover.filter((({target:t})=>t.parentNode.parentNode!==l.grid.node)),E=merge(N,A),T=_.map((({target:{dataset:{live:t,row:e,col:r}}})=>w.takeUntil(E).map((({target:{dataset:{row:e,col:r}}})=>({live:t,row:e,col:r}))).startWith({live:t,row:e,col:r}))).flatten(),L=Array(108).fill().map(((t,e)=>Array(100).fill().map(((t,r)=>{const a=(n=e,o=r,combine(S,T.filter((({row:t,col:e})=>[t,e]===[n,o])).map((({live:t})=>t))).map((([t,e])=>t?empty():of(e))).flatten());var n,o;return((t,e)=>k.map((()=>merge(L[t-1]?.[e-1],L[t-1]?.[e],L[t-1]?.[e+1],L[t]?.[e-1],L[t]?.[e+1],L[t+1]?.[e-1],L[t+1]?.[e],L[t+1]?.[e+1]).take(1).map((t=>t.reduce(((t,e)=>t+e)))))).flatten())(e,r).scan(((t,e)=>t?is_2_or_3(e):is_3(e)),!1).flatMap((t=>S.flatMap((e=>e?of(t):a))))})))),O=table({should_update:!1,attr:{ondragstart:"return false",ondrop:"return false"}},tbody(L.map({id:"grid"},(t=>tr(t.map((t=>td({subscribe:[t,(t,e)=>t.dataset.live=e]})))))))),C=S.map((t=>[" Speed: ",number_input({id:"speed_input"}),button(t?"Stop":"Go",{id:"go_button"}),button("Tick",{id:"tick_button",attr:{disabled:t}}),button("Clear",{id:"clear_button"}),O()]));((t,e)=>{e.scan(((e,r)=>(g(t.parentElement,{children:Array.isArray(r)?r:[r]},e),r))).subscribe()})(document.body,C)})();